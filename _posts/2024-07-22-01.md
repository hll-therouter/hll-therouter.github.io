---
layout: post
title: "1.2.3版本编译改动"
description: "从`1.2.3-rc1`版本开始，我们对`TheRouter`编译过程做了大量优化，同时适配了`Gradle`的`4.x-8.x`全部版本，理论上更新的版本或更老的版本也能支持，只是没有去测试。   "
categories: docs
level: 1
tag: "框架简介" 
android: true 
---

## 背景
从`1.2.3-rc1`版本开始，我们对`TheRouter`编译过程做了大量优化，同时适配了`Gradle`的`4.x-8.x`全部版本，理论上更新的版本或更老的版本也能支持，只是没有去测试。   

## 改动一：编译期选项

老版本的`TheRouter`提供了不少编译期选项，可以通过手动在`local.properties`或`gradle.properties`文件中配置。从`1.2.3-rc1`版本开始，这些配置全部迁移到了app module的 `build.gradle` 内。你可以使用如下方式配置编译选项：   

```
// 注意，必须是app module内
apply plugin: 'com.android.application'
// 引入 therouter 插件
apply plugin: 'therouter'

// gradle7及以后的新版本Gradle可以这样写
// plugins {
//    id 'com.android.application'
//    id 'therouter'
// }

// 这里做编译配置，与android{}闭包在同级
TheRouter {
    // 是否开启调试模式
    public boolean debug = false;
    // 编译期检查路由表合法性，可选参数 warning(仅告警)/error(编译期抛异常)/delete(每次根据注解重新生成路由表)，不配置则不校验
    public String checkRouteMap = "";
    // 检查 FlowTask 是否有循环引用，可选参数 warning(仅打印日志)/error(编译期抛异常)，不配置则不校验
    public String checkFlowDepend = "";
    // 图形化输出当前的 FlowTask 依赖图，不配则不输出
    public String showFlowDepend = "true";
}

```

## 改动二：编译缓存

从`1.2.3-rc1`版本开始，所有编译均采用增量编译，且不再依赖`Gradle`的增量配置，所有增量均由框架内部实现，每次编译时会校验编译`jar`包与缓存数据是否一致，如果不一致才会去扫描有变更的`jar`包。因此，才能做到编译速度大幅提升。   
缓存路径在：/app/build/therouter目录下。

**建议您在构建发布包时，先执行`clean`，清理缓存**


## 改动三：默认服务提供者

老版本的`TheRouter`，如果使用了一个不存在`ServiceProvider`的`Service`接口时，会默认创建一个接口的空实现类来避免空指针。但实际应用起来发现，并不能降低空指针的概率，反倒将原本应该在开发阶段就发现的问题延到了线上才发现。   
从`1.2.3-rc1`开始，如果没有声明`@ServiceProvider`的接口，调用`TheRouter.get()`时，将会直接返回`null`。   

